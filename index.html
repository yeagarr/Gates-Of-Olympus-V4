<!doctype html>
<html lang="id">
<head>
  <!-- =========================
    BLOK 1 — META / SEO / PWA-LITE
  ========================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#070612" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Zeus Lucky Spin</title>

  <!-- =========================
    BLOK 2 — FONTS
  ========================== -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    /* =========================
      BLOK 3 — THEME TOKENS (ZEUS)
    ========================== */
    :root{
      --bg0:#070612;
      --bg1:#120a2d;

      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);

      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);

      --purple:#7b2cff;
      --purple2:#b04cff;

      --gold:#ffcc66;
      --gold2:#ffd78a;

      --green:#31d26a;
      --green2:#11b954;

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 10px 30px rgba(0,0,0,.45);

      --r: 22px;

      --easeOut: cubic-bezier(.14,.9,.18,1);
      --easeSmall: cubic-bezier(.2,.9,.2,1);
      --easeSpring: cubic-bezier(.16,1,.3,1);

      --spinDur: 5.2s;
      --spinEase: cubic-bezier(.08,.92,.2,1);

      --fxAlpha: .85;
    }

    /* =========================
      BLOK 4 — RESET / BASE
    ========================== */
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 600px at 18% 18%, rgba(123,44,255,.28), transparent 58%),
        radial-gradient(900px 520px at 85% 35%, rgba(49,210,106,.12), transparent 62%),
        radial-gradient(900px 700px at 60% 112%, rgba(255,204,102,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
    }

    .srOnly{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    /* =========================
      BLOK 5 — BACKDROP SPARKS + NOISE
    ========================== */
    .sparks{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.22;
      mix-blend-mode: screen;
      background:
        radial-gradient(2px 2px at 10% 18%, rgba(255,255,255,.7), transparent 60%),
        radial-gradient(2px 2px at 26% 72%, rgba(255,255,255,.6), transparent 60%),
        radial-gradient(1px 1px at 70% 30%, rgba(255,204,102,.7), transparent 60%),
        radial-gradient(2px 2px at 86% 64%, rgba(176,76,255,.8), transparent 60%),
        radial-gradient(1px 1px at 52% 18%, rgba(49,210,106,.6), transparent 60%),
        radial-gradient(2px 2px at 44% 82%, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(2px 2px at 9% 55%, rgba(255,204,102,.45), transparent 60%);
      animation: sparkle 6.5s var(--easeOut) infinite;
    }
    @keyframes sparkle{
      0%,100%{ transform: translateY(0); opacity:.18; }
      50%{ transform: translateY(-8px); opacity:.28; }
    }

    /* noise overlay (halus, tidak ganggu) */
    .noise{
      position:fixed; inset:-20%;
      pointer-events:none;
      opacity:.06;
      mix-blend-mode: overlay;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.9'/%3E%3C/svg%3E");
      background-size: 220px 220px;
      animation: noiseMove 10s linear infinite;
      transform: translateZ(0);
    }
    @keyframes noiseMove{
      0%{ transform: translate3d(-1%, -1%, 0); }
      100%{ transform: translate3d(1%, 1%, 0); }
    }

    /* =========================
      BLOK 6 — CANVAS FX PARTICLES
    ========================== */
    .fxCanvas{
      position:fixed; inset:0;
      width:100%; height:100%;
      pointer-events:none;
      z-index: 9;
      opacity: var(--fxAlpha);
      mix-blend-mode: screen;
    }

    /* =========================
      BLOK 7 — LAYOUT WRAP / TOPBAR
    ========================== */
    .wrap{
      max-width: 1180px;
      padding: calc(18px + env(safe-area-inset-top)) 18px calc(46px + env(safe-area-inset-bottom));
      margin: 0 auto;
      position:relative;
      z-index: 10;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .btn{
      appearance:none;
      border:0;
      cursor:pointer;
      user-select:none;
      touch-action: manipulation;
      color:#04110a;
      font-weight:900;
      letter-spacing:.3px;
      padding: 10px 14px;
      border-radius: 12px;
      background: linear-gradient(180deg, var(--green), var(--green2));
      box-shadow: 0 10px 30px rgba(17,185,84,.18);
      transition: transform .15s var(--easeSmall), filter .15s var(--easeSmall), box-shadow .15s var(--easeSmall);
    }
    @media (hover:hover){
      .btn:hover{ transform: translateY(-1px); filter: brightness(1.03); box-shadow: 0 12px 34px rgba(17,185,84,.22); }
    }
    .btn:active{ transform: translateY(0px) scale(.99); }
    .btn:focus-visible{
      outline:none;
      box-shadow: 0 0 0 3px rgba(255,255,255,.18), 0 0 0 6px rgba(49,210,106,.18);
    }

    .btn.secondary{
      color: var(--text);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: var(--shadow2);
      font-weight: 800;
    }
    .btn.secondary:focus-visible{
      box-shadow: 0 0 0 3px rgba(255,255,255,.18), 0 0 0 6px rgba(176,76,255,.18), var(--shadow2);
    }

    /* =========================
      BLOK 8 — STAGE / GRID / PANELS
    ========================== */
    .stage{
      position:relative;
      border-radius: calc(var(--r) + 10px);
      background:
        radial-gradient(900px 520px at 18% 30%, rgba(123,44,255,.18), transparent 58%),
        radial-gradient(900px 520px at 82% 35%, rgba(255,204,102,.08), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      overflow:hidden;
      padding: clamp(14px, 2.2vw, 22px);
    }

    .grid{
      position:relative;
      display:grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap: 18px;
      align-items: stretch;
      z-index:1;
    }

    .panel{
      border-radius: var(--r);
      padding: clamp(14px, 2vw, 18px);
      background: linear-gradient(180deg, rgba(0,0,0,.16), rgba(0,0,0,.08));
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
      position:relative;
    }

    .title{
      font-size: clamp(26px, 3.3vw, 36px);
      line-height: 1.02;
      font-weight: 900;
      letter-spacing: .2px;
      margin: 0 0 6px;
    }
    .title .accent{ color: var(--green); }
    .subtitle{
      margin: 0 0 14px;
      font-size: 13.5px;
      color: var(--muted);
      font-weight: 600;
      letter-spacing: .15px;
    }

    .formRow{
      display:flex;
      gap:10px;
      align-items: stretch;
      margin-bottom: 14px;
    }
    .input{
      flex:1;
      border-radius: 14px;
      padding: 12px 12px;
      border: 1px solid rgba(255,255,255,.14);
      outline: none;
      background: rgba(0,0,0,.18);
      color: var(--text);
      font-weight: 800;
      letter-spacing: .2px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    .input::placeholder{ color: rgba(255,255,255,.45); font-weight: 600; }
    .input:focus-visible{
      border-color: rgba(49,210,106,.35);
      box-shadow: 0 0 0 3px rgba(49,210,106,.16), inset 0 1px 0 rgba(255,255,255,.06);
    }

    /* =========================
      BLOK 9 — WHEEL (ROTOR + LED RING + POINTER)
    ========================== */
    .wheelWrap{
      width: min(420px, 100%);
      margin: 10px auto 12px;
      position:relative;
      aspect-ratio: 1 / 1;
      display:grid;
      place-items:center;
      isolation:isolate;
    }

    /* outer glow ring */
    .wheelWrap::before{
      content:"";
      position:absolute; inset:-10px;
      border-radius: 999px;
      background:
        radial-gradient(closest-side, rgba(255,204,102,.14), transparent 68%),
        radial-gradient(closest-side, rgba(176,76,255,.10), transparent 70%);
      filter: blur(2px);
      opacity:.8;
      pointer-events:none;
      z-index:0;
    }

    /* LED ring */
    .wheelWrap::after{
      content:"";
      position:absolute; inset: -4px;
      border-radius: 999px;
      background:
        repeating-conic-gradient(
          from -10deg,
          rgba(255,204,102,.65) 0deg 6deg,
          rgba(255,204,102,0)   6deg 14deg
        );
      mask: radial-gradient(closest-side, transparent 76%, #000 79%);
      opacity:.42;
      pointer-events:none;
      z-index: 4;
      transform: rotate(0deg);
      transition: opacity .2s var(--easeOut);
    }

    .wheelWrap.isSpinning::after{
      opacity:.62;
      animation: ledSpin 1.1s linear infinite;
    }
    @keyframes ledSpin{
      from{ transform: rotate(0deg); }
      to{ transform: rotate(360deg); }
    }

    .pointer{
      position:absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 13px solid transparent;
      border-right: 13px solid transparent;
      border-bottom: 24px solid var(--gold);
      filter: drop-shadow(0 10px 18px rgba(255,204,102,.22));
      z-index: 7;
    }
    .pointer::after{
      content:"";
      position:absolute;
      left:-10px;
      top: 18px;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.28), rgba(255,204,102,.18), transparent 68%);
      filter: blur(.2px);
      opacity:.9;
      transform: translateZ(0);
    }
    .wheelWrap.isSpinning .pointer{
      animation: pointerPulse .45s var(--easeSpring) infinite;
    }
    @keyframes pointerPulse{
      0%,100%{ transform: translateX(-50%) translateY(0px); }
      50%{ transform: translateX(-50%) translateY(2px); }
    }

    /* ROTOR (yang muter cuma ini) */
    .wheelRotor{
      position:absolute;
      inset: 0;
      border-radius: 999px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.16);
      box-shadow:
        0 22px 70px rgba(0,0,0,.60),
        inset 0 1px 0 rgba(255,255,255,.16);
      background: conic-gradient(
        from -22.5deg,
        rgba(176,76,255,.95) 0deg 45deg,
        rgba(123,44,255,.92) 45deg 90deg,
        rgba(176,76,255,.95) 90deg 135deg,
        rgba(123,44,255,.92) 135deg 180deg,
        rgba(176,76,255,.95) 180deg 225deg,
        rgba(123,44,255,.92) 225deg 270deg,
        rgba(176,76,255,.95) 270deg 315deg,
        rgba(123,44,255,.92) 315deg 360deg
      );
      transform: rotate(0deg);
      will-change: transform;
      transition: transform var(--spinDur) var(--spinEase);
      z-index: 1;
    }
    .wheelRotor::before{
      content:"";
      position:absolute; inset: 10px;
      border-radius: 999px;
      border: 2px solid rgba(255,204,102,.60);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.35);
      opacity:.95;
      pointer-events:none;
    }
    .wheelRotor::after{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(closest-side at 50% 38%, rgba(255,255,255,.16), transparent 60%),
        radial-gradient(closest-side at 50% 76%, rgba(0,0,0,.22), transparent 72%),
        conic-gradient(from 0deg, rgba(255,204,102,.10), transparent 25%, rgba(49,210,106,.06), transparent 55%, rgba(176,76,255,.10));
      mix-blend-mode: screen;
      opacity:.9;
    }
    .wheelWrap.isSpinning .wheelRotor{
      filter: saturate(1.05) brightness(1.02);
    }

    .labels{
      position:absolute;
      inset:0;
      z-index: 2;
      pointer-events:none;
    }
    .label{
      position:absolute;
      left: 50%;
      top: 50%;
      transform-origin: center center;
      width: clamp(120px, 38vw, 170px);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .label span{
      width: 100%;
      text-align:center;
      padding: 7px 10px;
      border-radius: 999px;
      font-size: clamp(10px, 2.6vw, 12px);
      font-weight: 900;
      letter-spacing: .25px;
      color: rgba(255,255,255,.92);
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 22px rgba(0,0,0,.26);
      text-shadow: 0 1px 0 rgba(0,0,0,.28);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      transition: transform .2s var(--easeOut), filter .2s var(--easeOut), background .2s var(--easeOut);
    }
    .label.isWin span{
      background: rgba(255,204,102,.22);
      border-color: rgba(255,204,102,.32);
      filter: drop-shadow(0 10px 24px rgba(255,204,102,.16));
      transform: scale(1.03);
    }

    /* HUB (tombol di tengah - tidak ikut muter) */
    .hubBtn{
      position:absolute;
      inset: 50% auto auto 50%;
      transform: translate(-50%, -50%);
      width: clamp(92px, 18vw, 110px);
      height: clamp(92px, 18vw, 110px);
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.22);
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,.24), transparent 55%),
        linear-gradient(180deg, rgba(255,204,102,.92), rgba(255,204,102,.62));
      box-shadow:
        0 18px 40px rgba(0,0,0,.45),
        inset 0 1px 0 rgba(255,255,255,.30);
      color: #1a0f2f;
      font-weight: 900;
      letter-spacing: .5px;
      display:grid;
      place-items:center;
      cursor:pointer;
      z-index: 8;
      user-select:none;
      touch-action: manipulation;
      transition: transform .12s var(--easeSmall), filter .12s var(--easeSmall), box-shadow .12s var(--easeSmall);
    }
    @media (hover:hover){
      .hubBtn:hover{ filter: brightness(1.04); }
    }
    .hubBtn small{
      display:block;
      font-size: 11px;
      opacity:.92;
      margin-top: 4px;
      font-weight: 900;
    }
    .hubBtn:active{ transform: translate(-50%, -50%) scale(.99); }
    .hubBtn:focus-visible{
      outline:none;
      box-shadow: 0 0 0 3px rgba(255,255,255,.18), 0 0 0 6px rgba(255,204,102,.18), 0 18px 40px rgba(0,0,0,.45);
    }
    .hubBtn[disabled]{ cursor:not-allowed; opacity:.55; filter: grayscale(.12) brightness(.92); }

    .ctaRow{
      display:flex;
      justify-content:center;
      margin-top: 10px;
    }
    .spinBtn{
      width: min(420px, 100%);
      padding: 14px 18px;
      border-radius: 16px;
      font-size: 15px;
      font-weight: 900;
    }
    .spinBtn[disabled]{
      cursor:not-allowed;
      filter: grayscale(.1) brightness(.92);
      opacity:.75;
      transform:none !important;
    }

    .tries{
      text-align:center;
      font-size: 12.5px;
      color: rgba(255,255,255,.75);
      font-weight: 800;
      letter-spacing:.2px;
      margin-top: 8px;
    }

    /* =========================
      BLOK 10 — RIGHT PANEL (ZEUS / JACKPOT / CARDS)
    ========================== */
    .right{
      border-radius: var(--r);
      padding: clamp(12px, 1.8vw, 14px);
      background: linear-gradient(180deg, rgba(0,0,0,.16), rgba(0,0,0,.06));
      border: 1px solid rgba(255,255,255,.12);
      position:relative;
      overflow:hidden;
      display:grid;
      grid-template-rows: auto 1fr auto;
      gap: 12px;
      min-height: 520px;
    }

    .jackpot{
      border-radius: 16px;
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.12);
    }
    .jackpot .lbl{
      color: rgba(255,255,255,.75);
      font-weight: 800;
      font-size: 12.5px;
      letter-spacing:.18px;
    }
    .jackpot .val{
      font-weight: 900;
      letter-spacing:.3px;
      color: rgba(255,255,255,.92);
    }
    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.14);
      font-weight: 900;
      color: rgba(255,255,255,.90);
      font-size: 12px;
      letter-spacing: .2px;
      white-space: nowrap;
    }

    .zeusArea{
      position:relative;
      display:grid;
      place-items:center;
      min-height: 360px;
      border-radius: 18px;
      background:
        radial-gradient(360px 260px at 55% 50%, rgba(160,235,255,.20), transparent 70%),
        radial-gradient(460px 360px at 35% 55%, rgba(123,44,255,.14), transparent 70%);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .zeusArea::before{
      content:"";
      position:absolute; inset:-40px;
      background:
        radial-gradient(closest-side at 48% 52%, rgba(255,204,102,.14), transparent 62%),
        radial-gradient(closest-side at 52% 58%, rgba(49,210,106,.10), transparent 64%),
        radial-gradient(closest-side at 50% 50%, rgba(176,76,255,.12), transparent 66%);
      filter: blur(10px);
      opacity:.75;
      animation: aura 6.5s var(--easeOut) infinite;
      pointer-events:none;
    }
    @keyframes aura{
      0%,100%{ transform: translate3d(0,0,0) scale(1); opacity:.68; }
      50%{ transform: translate3d(0,-6px,0) scale(1.02); opacity:.86; }
    }

    .zeusImg{
      width: min(420px, 92%);
      height: auto;
      object-fit: contain;
      filter: drop-shadow(0 26px 80px rgba(0,0,0,.60));
      transform: translateY(10px);
      user-select:none;
      -webkit-user-drag:none;
      animation: zeusFloat 3.6s ease-in-out infinite;
      will-change: transform;
      position: relative;
      z-index: 2;
    }
    @keyframes zeusFloat{
      0%, 100% { transform: translateY(10px) rotate(-0.4deg); }
      50%      { transform: translateY(-10px) rotate(0.4deg); }
    }

    .zeusError{
      display:none;
      padding: 16px;
      text-align:center;
      color: rgba(255,255,255,.82);
      font-weight: 800;
      position:relative;
      z-index: 2;
    }
    .zeusError code{
      display:block;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.90);
      font-weight: 700;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .cards{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .card{
      border-radius: 18px;
      padding: 12px 12px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 12px 26px rgba(0,0,0,.22);
      min-height: 64px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .card strong{
      font-weight: 900;
      letter-spacing:.2px;
      font-size: 13px;
    }
    .card span{
      color: rgba(255,255,255,.72);
      font-weight: 800;
      font-size: 12px;
      letter-spacing:.15px;
    }

    /* =========================
      BLOK 11 — HISTORY TABLE
    ========================== */
    .history{
      margin-top: 16px;
      border-radius: calc(var(--r) + 10px);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .historyHead{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      flex-wrap: wrap;
    }
    .historyHead h3{
      margin:0;
      font-size: 14px;
      font-weight: 900;
      letter-spacing:.2px;
    }
    .historyHead .tools{ display:flex; gap: 8px; flex-wrap:wrap; }

    table{
      width:100%;
      border-collapse: collapse;
      font-size: 12.8px;
    }
    thead th{
      text-align:left;
      padding: 10px 16px;
      color: rgba(255,255,255,.72);
      font-weight: 900;
      letter-spacing:.13px;
      background: rgba(0,0,0,.12);
      position: sticky;
      top: 0;
      backdrop-filter: blur(8px);
      z-index: 1;
    }
    tbody td{
      padding: 10px 16px;
      border-top: 1px solid rgba(255,255,255,.08);
      color: rgba(255,255,255,.86);
      font-weight: 700;
    }
    tbody tr:hover td{ background: rgba(255,255,255,.04); }

    /* =========================
      BLOK 12 — TOAST
    ========================== */
    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(18px + env(safe-area-inset-bottom));
      transform: translateX(-50%);
      z-index: 60;
      min-width: min(560px, calc(100vw - 24px));
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(0,0,0,.60);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 12px 42px rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
    }
    @supports (backdrop-filter: blur(10px)){
      .toast{ backdrop-filter: blur(10px); }
    }
    .toast b{ font-weight: 900; }
    .toast small{ color: rgba(255,255,255,.72); font-weight: 700; }
    .toast.show{ display:flex; animation: toastIn .22s ease-out; }
    @keyframes toastIn{
      from{ transform: translateX(-50%) translateY(8px); opacity:0; }
      to{ transform: translateX(-50%) translateY(0px); opacity:1; }
    }

    /* =========================
      BLOK 13 — MODAL
    ========================== */
    .modalOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 80;
    }
    @supports (backdrop-filter: blur(8px)){
      .modalOverlay{ backdrop-filter: blur(8px); }
    }
    .modalOverlay.show{ display:flex; }
    .modal{
      width: min(520px, 100%);
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 28px 90px rgba(0,0,0,.60);
      overflow:hidden;
      position:relative;
    }
    .modal::before{
      content:"";
      position:absolute; inset:-60px;
      background:
        radial-gradient(closest-side at 50% 40%, rgba(255,204,102,.18), transparent 62%),
        radial-gradient(closest-side at 65% 60%, rgba(176,76,255,.12), transparent 64%);
      filter: blur(14px);
      opacity:.9;
      pointer-events:none;
    }
    .modalHead{ padding: 18px 18px 10px; position:relative; }
    .modalHead h2{
      margin:0;
      font-size: 22px;
      font-weight: 900;
      letter-spacing:.25px;
    }
    .modalBody{ padding: 0 18px 18px; position:relative; }
    .modalBody p{
      margin: 10px 0;
      color: rgba(255,255,255,.80);
      font-weight: 700;
      line-height: 1.45;
    }
    .winBox{
      margin-top: 10px;
      border-radius: 20px;
      padding: 14px 14px;
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.12);
    }
    .winBox .big{
      font-size: 18px;
      font-weight: 900;
      letter-spacing:.2px;
      color: rgba(255,255,255,.94);
    }
    .modalActions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:flex-end;
      margin-top: 14px;
    }

    /* =========================
      BLOK 14 — RESPONSIVE
    ========================== */
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .formRow{ flex-direction: column; }
      .cards{ grid-template-columns: 1fr; }
      .right{ min-height: unset; }
    }

    /* =========================
      BLOK 15 — REDUCED MOTION
    ========================== */
    @media (prefers-reduced-motion: reduce){
      .sparks, .noise{ animation:none !important; }
      .wheelRotor{ transition:none !important; }
      .btn, .hubBtn{ transition:none !important; }
      .toast.show{ animation:none !important; }
      .zeusImg{ animation: none !important; }
      .wheelWrap.isSpinning::after{ animation:none !important; }
      .wheelWrap.isSpinning .pointer{ animation:none !important; }
      .fxCanvas{ display:none !important; }
    }
  </style>
</head>

<body>
  <!-- =========================
    BLOK A — BACKGROUND LAYERS
  ========================== -->
  <div class="sparks" aria-hidden="true"></div>
  <div class="noise" aria-hidden="true"></div>
  <canvas class="fxCanvas" id="fxCanvas" aria-hidden="true"></canvas>

  <!-- =========================
    BLOK B — APP WRAP
  ========================== -->
  <div class="wrap">
    <div class="topbar">
      <button class="btn secondary" id="btnReset" type="button">RESET</button>
      <button class="btn" id="btnRegister" type="button">REGISTER</button>
    </div>

    <section class="stage" aria-label="Zeus Lucky Spin">
      <div class="grid">

        <!-- =========================
          BLOK C — LEFT / INPUT + WHEEL
        ========================== -->
        <div class="panel">
          <h1 class="title">SPIN THE WHEEL<br><span class="accent">AND GET BONUSES!</span></h1>
          <div class="subtitle">
            Masukkan <b>User ID</b> untuk memutar roda. (Mode hiburan, data disimpan di browser kamu.)
          </div>

          <div class="formRow">
            <label class="srOnly" for="userId">User ID</label>
            <input id="userId" class="input" placeholder="MASUKKAN USER ID..." autocomplete="off" inputmode="text" />
            <button class="btn" id="btnSetId" type="button">SIMPAN ID</button>
          </div>

          <div class="wheelWrap" id="wheelWrap">
            <div class="pointer" aria-hidden="true"></div>

            <div class="wheelRotor" id="wheelRotor" aria-label="Lucky spin wheel">
              <div class="labels" id="labels"></div>
            </div>

            <button class="hubBtn" id="hubBtn" type="button" title="Klik untuk memutar">
              SPIN
              <small>NOW</small>
            </button>
          </div>

          <div class="ctaRow">
            <button class="btn spinBtn" id="btnSpin" type="button">SPIN SEKARANG!</button>
          </div>
          <div class="tries" id="triesText">MASUKKAN USER ID DULU</div>
        </div>

        <!-- =========================
          BLOK D — RIGHT / ZEUS + STATS
        ========================== -->
        <div class="right">
          <div class="jackpot">
            <div>
              <div class="lbl">Total Jackpot</div>
              <div class="val" id="jackpotVal">IDR 888.888.888</div>
            </div>
            <div class="pill" id="statusPill" aria-live="polite">READY</div>
          </div>

          <div class="zeusArea" id="zeusArea">
            <img class="zeusImg" id="zeusImg" src="/assets/zeus.png" alt="Zeus">
            <div class="zeusError" id="zeusError">
              Zeus PNG gagal dimuat.
              <code id="zeusTried">/assets/zeus.png</code>
              <div style="margin-top:10px; font-weight:700; color: rgba(255,255,255,.72); font-size: 12.5px;">
                Pastikan file ada di <b>/assets</b> dan namanya tepat: <b>zeus.png</b>
              </div>
            </div>
          </div>

          <div class="cards">
            <div class="card">
              <div>
                <strong>Bonus Spins</strong><br>
                <span>Akumulasi hadiah</span>
              </div>
              <div class="pill" id="cardSpins">0</div>
            </div>
            <div class="card">
              <div>
                <strong>Last Prize</strong><br>
                <span>Hasil terakhir</span>
              </div>
              <div class="pill" id="cardLast">—</div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- =========================
      BLOK E — HISTORY
    ========================== -->
    <section class="history" aria-label="Riwayat spin">
      <div class="historyHead">
        <h3>50 Daftar Riwayat Spin Terakhir</h3>
        <div class="tools">
          <button class="btn secondary" id="btnClearHistory" type="button">HAPUS RIWAYAT</button>
        </div>
      </div>

      <div style="overflow:auto; max-height: 420px;">
        <table>
          <thead>
            <tr>
              <th style="width:70px;">NO</th>
              <th style="min-width:180px;">USER ID</th>
              <th>HADIAH</th>
              <th style="min-width:160px;">WAKTU</th>
            </tr>
          </thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- =========================
    BLOK F — TOAST
  ========================== -->
  <div class="toast" id="toast" role="status" aria-live="polite" aria-atomic="true">
    <div>
      <b id="toastTitle">Info</b><br>
      <small id="toastText">—</small>
    </div>
    <button class="btn secondary" id="toastClose" type="button">OK</button>
  </div>

  <!-- =========================
    BLOK G — MODAL
  ========================== -->
  <div class="modalOverlay" id="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Hasil Spin">
      <div class="modalHead">
        <h2 id="modalTitle">SELAMAT!</h2>
      </div>
      <div class="modalBody">
        <p id="modalDesc">Kamu mendapatkan hadiah:</p>

        <div class="winBox">
          <div class="big" id="modalPrize">—</div>
          <p style="margin:10px 0 0; font-size: 12.5px; color: rgba(255,255,255,.70);">
            Tips: Screenshot halaman ini untuk bukti hasil (opsional).
          </p>
        </div>

        <div class="modalActions">
          <button class="btn secondary" id="btnCopy" type="button">COPY HASIL</button>
          <button class="btn" id="btnClaim" type="button">KLAIM SEKARANG</button>
          <button class="btn secondary" id="btnCloseModal" type="button">TUTUP</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    "use strict";

    /* =========================
      BLOK 1 — CONFIG
    ========================== */
    const ZEUS_SRC = "/assets/zeus.png";

    const SEGMENTS = [
      { label: "150 FREE SPINS", kind: "spins", value: 150 },
      { label: "100 FREE SPINS", kind: "spins", value: 100 },
      { label: "50 FREE SPINS",  kind: "spins", value:  50 },
      { label: "TRY AGAIN",      kind: "again", value:   0 },
      { label: "MEGA BONUS x10", kind: "bonus", value: "x10" },
      { label: "20 FREE SPINS",  kind: "spins", value:  20 },
      { label: "BONUS x5",       kind: "bonus", value: "x5" },
      { label: "10 FREE SPINS",  kind: "spins", value:  10 },
    ];

    const MAX_HISTORY = 50;

    const STORAGE = {
      userId: "zeus_spin_userId_v4",
      history: "zeus_spin_history_v4",
      usedPrefix: "zeus_used_once_v4__",
      againPrefix: "zeus_again_once_v4__",
      lastResultPrefix: "zeus_last_prize_v4__",
      spinsPrefix: "zeus_spins_total_v4__",
    };

    /* =========================
      BLOK 2 — DOM
    ========================== */
    const $ = (id)=> document.getElementById(id);

    const elRotor = $("wheelRotor");
    const elLabels = $("labels");
    const elWheelWrap = $("wheelWrap");

    const elHubBtn = $("hubBtn");
    const elBtnSpin = $("btnSpin");
    const elUserId = $("userId");
    const elBtnSetId = $("btnSetId");

    const elTriesText = $("triesText");
    const elStatusPill = $("statusPill");
    const elCardSpins = $("cardSpins");
    const elCardLast = $("cardLast");

    const elToast = $("toast");
    const elToastTitle = $("toastTitle");
    const elToastText = $("toastText");
    const elToastClose = $("toastClose");

    const elModalOverlay = $("modalOverlay");
    const elModalPrize = $("modalPrize");
    const elBtnCloseModal = $("btnCloseModal");
    const elBtnClaim = $("btnClaim");
    const elBtnCopy = $("btnCopy");

    const elHistoryBody = $("historyBody");
    const elBtnClearHistory = $("btnClearHistory");
    const elBtnReset = $("btnReset");
    const elBtnRegister = $("btnRegister");

    const elZeusImg = $("zeusImg");
    const elZeusArea = $("zeusArea");
    const elZeusError = $("zeusError");
    const elZeusTried = $("zeusTried");

    const elFxCanvas = $("fxCanvas");

    /* =========================
      BLOK 3 — STATE
    ========================== */
    const segCount = SEGMENTS.length;
    const segSize = 360 / segCount;

    let isSpinning = false;
    let currentRotation = 0;
    let lastFocusEl = null;
    let spinToken = 0;

    const prefersReducedMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    /* =========================
      BLOK 4 — UTILS (SAFE / STORAGE / TIME)
    ========================== */
    const normDeg = (d)=> ((d % 360) + 360) % 360;

    function safeText(s){ return String(s ?? ""); }
    function escapeHtml(s){
      return safeText(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function nowText(){
      const d = new Date();
      const pad = (x)=> String(x).padStart(2,"0");
      return `${pad(d.getDate())}-${pad(d.getMonth()+1)}-${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }

    function storageGet(key, fallback){
      try{
        const v = localStorage.getItem(key);
        return (v === null || v === undefined) ? fallback : v;
      }catch(_){ return fallback; }
    }
    function storageSet(key, val){ try{ localStorage.setItem(key, val); }catch(_){} }
    function storageDel(key){ try{ localStorage.removeItem(key); }catch(_){} }

    function cleanUserId(raw){
      // rapihin: trim + batas panjang + buang karakter aneh (biar aman untuk key)
      const s = safeText(raw).trim().slice(0, 48);
      return s.replace(/[^\w\-\.@]/g, ""); // huruf/angka/_- . @
    }
    function getUserId(){ return cleanUserId(elUserId.value); }

    function usedKey(userId){ return STORAGE.usedPrefix + userId; }
    function againKey(userId){ return STORAGE.againPrefix + userId; }
    function lastKey(userId){ return STORAGE.lastResultPrefix + userId; }
    function spinsKey(userId){ return STORAGE.spinsPrefix + userId; }

    function isUserUsed(userId){
      if(!userId) return false;
      return storageGet(usedKey(userId), "0") === "1";
    }
    function setUserUsed(userId, used){
      if(!userId) return;
      storageSet(usedKey(userId), used ? "1" : "0");
    }

    function isAgainUsed(userId){
      if(!userId) return false;
      return storageGet(againKey(userId), "0") === "1";
    }
    function setAgainUsed(userId, used){
      if(!userId) return;
      storageSet(againKey(userId), used ? "1" : "0");
    }

    function setLastResult(userId, prize){
      if(!userId) return;
      storageSet(lastKey(userId), prize);
    }
    function getLastResult(userId){
      if(!userId) return "";
      return storageGet(lastKey(userId), "");
    }

    function getSpinsTotal(userId){
      if(!userId) return 0;
      return Number(storageGet(spinsKey(userId), "0")) || 0;
    }
    function setSpinsTotal(userId, n){
      if(!userId) return;
      storageSet(spinsKey(userId), String(Math.max(0, Number(n)||0)));
    }

    function rand01(){
      try{
        const a = new Uint32Array(1);
        crypto.getRandomValues(a);
        return a[0] / 4294967296;
      }catch(_){
        return Math.random();
      }
    }

    /* =========================
      BLOK 5 — HISTORY
    ========================== */
    function getHistory(){
      try{
        const raw = storageGet(STORAGE.history, "[]");
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      }catch(_){ return []; }
    }
    function setHistory(arr){
      try{ storageSet(STORAGE.history, JSON.stringify(arr.slice(0, MAX_HISTORY))); }catch(_){}
    }
    function addHistory(userId, prize){
      const arr = getHistory();
      arr.unshift({ userId, prize, time: nowText() });
      setHistory(arr);
      renderHistory();
    }
    function renderHistory(){
      const arr = getHistory();
      elHistoryBody.innerHTML = arr.slice(0, MAX_HISTORY).map((it, idx)=>`
        <tr>
          <td>${idx+1}</td>
          <td>${escapeHtml(it.userId)}</td>
          <td>${escapeHtml(it.prize)}</td>
          <td>${escapeHtml(it.time)}</td>
        </tr>
      `).join("") || `
        <tr>
          <td colspan="4" style="padding:14px 16px; color: rgba(255,255,255,.74); font-weight:700;">
            Belum ada riwayat.
          </td>
        </tr>
      `;
    }

    /* =========================
      BLOK 6 — TOAST / MODAL + FOCUS TRAP
    ========================== */
    function showToast(title, text){
      elToastTitle.textContent = safeText(title);
      elToastText.textContent = safeText(text);
      elToast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> elToast.classList.remove("show"), 3200);
    }

    function modalFocusable(){
      return Array.from(elModalOverlay.querySelectorAll("button,[href],input,select,textarea,[tabindex]:not([tabindex='-1'])"))
        .filter(el => !el.hasAttribute("disabled") && !el.getAttribute("aria-hidden"));
    }

    function openModal(prizeText){
      lastFocusEl = document.activeElement;
      elModalPrize.textContent = prizeText;
      elModalOverlay.classList.add("show");
      elModalOverlay.setAttribute("aria-hidden","false");
      setTimeout(()=> elBtnClaim.focus({ preventScroll:true }), 0);
    }

    function closeModal(){
      elModalOverlay.classList.remove("show");
      elModalOverlay.setAttribute("aria-hidden","true");
      if(lastFocusEl && lastFocusEl.focus) lastFocusEl.focus({ preventScroll:true });
      lastFocusEl = null;
    }

    function handleModalTab(e){
      if(!elModalOverlay.classList.contains("show")) return;
      if(e.key !== "Tab") return;
      const f = modalFocusable();
      if(!f.length) return;
      const first = f[0], last = f[f.length - 1];
      if(e.shiftKey && document.activeElement === first){
        e.preventDefault(); last.focus();
      }else if(!e.shiftKey && document.activeElement === last){
        e.preventDefault(); first.focus();
      }
    }

    /* =========================
      BLOK 7 — WHEEL (LABELS / PICK / ROTATION)
    ========================== */
    function selectedIndexFromRotation(rotAbs){
      const rot = normDeg(rotAbs);
      const pointerAngle = normDeg(360 - rot);
      return Math.floor((pointerAngle + (segSize/2)) / segSize) % segCount;
    }

    function clearWinLabel(){
      elLabels.querySelectorAll(".label").forEach(n => n.classList.remove("isWin"));
    }
    function markWinLabel(idx){
      clearWinLabel();
      const node = elLabels.querySelector(`.label[data-idx="${idx}"]`);
      if(node) node.classList.add("isWin");
    }

    function buildLabels(){
      elLabels.innerHTML = "";
      for(let i=0;i<segCount;i++){
        const a = i * segSize;
        const div = document.createElement("div");
        div.className = "label";
        div.dataset.angle = String(a);
        div.dataset.idx = String(i);
        const span = document.createElement("span");
        span.textContent = SEGMENTS[i].label;
        div.appendChild(span);
        elLabels.appendChild(div);
      }
      layoutLabels();
    }

    function layoutLabels(){
      const wrap = elWheelWrap;
      if(!wrap) return;
      const size = Math.min(wrap.clientWidth, wrap.clientHeight);
      const radius = Math.max(86, Math.floor(size * 0.33));
      const labels = elLabels.querySelectorAll(".label");
      labels.forEach((node)=>{
        const angle = Number(node.dataset.angle || "0");
        const flip = (angle > 90 && angle < 270) ? 180 : 0;
        const rotText = 90 + flip;
        node.style.transform =
          `translate(-50%, -50%) rotate(${angle}deg) translate(0, -${radius}px) rotate(${rotText}deg)`;
      });
    }

    function setReadyUI(){
      const uid = getUserId();
      const used = isUserUsed(uid);
      const canSpin = !!uid && !used && !isSpinning;

      if(!uid){
        elTriesText.textContent = "MASUKKAN USER ID DULU";
      }else if(used){
        elTriesText.textContent = "KESEMPATAN SUDAH DIPAKAI";
      }else{
        const bonus = isAgainUsed(uid) ? "" : " (ADA CHANCE: TRY AGAIN)";
        elTriesText.textContent = "1 KESEMPATAN SPIN" + bonus;
      }

      elBtnSpin.disabled = !canSpin;
      elHubBtn.disabled = !canSpin;

      elStatusPill.textContent = (!uid) ? "ENTER ID" : (used ? "USED" : (isSpinning ? "SPINNING" : "READY"));

      const last = getLastResult(uid);
      elCardLast.textContent = last ? last : "—";
      elCardSpins.textContent = String(getSpinsTotal(uid));

      if(!isSpinning && elWheelWrap) elWheelWrap.classList.remove("isSpinning");
    }

    function setSpinningUI(v){
      isSpinning = v;
      if(elWheelWrap){
        elWheelWrap.classList.toggle("isSpinning", v);
      }
      elBtnSpin.disabled = v;
      elHubBtn.disabled = v;
      elStatusPill.textContent = v ? "SPINNING" : elStatusPill.textContent;
    }

    function pickIndex(uid){
      const blockAgain = isAgainUsed(uid);
      if(!blockAgain) return Math.floor(rand01() * segCount);

      for(let k=0;k<48;k++){
        const idx = Math.floor(rand01() * segCount);
        if(SEGMENTS[idx].kind !== "again") return idx;
      }
      return 0;
    }

    function applyRotation(deg, animate){
      elRotor.style.transition = animate ? "" : "none";
      elRotor.style.transform = `rotate(${deg}deg)`;
    }

    function vibrate(ms){
      try{
        if(navigator.vibrate) navigator.vibrate(ms);
      }catch(_){}
    }

    /* =========================
      BLOK 8 — FX PARTICLES (CANVAS)
    ========================== */
    const FX = (() => {
      if(prefersReducedMotion || !elFxCanvas) return null;

      const c = elFxCanvas;
      const ctx = c.getContext("2d", { alpha: true });
      let W = 0, H = 0, dpr = 1;

      const particles = [];
      const sparks = [];
      let running = true;
      let raf = 0;

      const clamp = (x,a,b)=> Math.max(a, Math.min(b, x));

      function resize(){
        dpr = clamp(window.devicePixelRatio || 1, 1, 2);
        W = Math.floor(window.innerWidth * dpr);
        H = Math.floor(window.innerHeight * dpr);
        c.width = W; c.height = H;
      }

      function addParticle(p){
        particles.push(p);
        if(particles.length > 360) particles.splice(0, particles.length - 360);
      }

      function burst(x,y, count=28, palette="gold"){
        const base = palette === "green" ? [49,210,106] : palette === "purple" ? [176,76,255] : [255,204,102];
        for(let i=0;i<count;i++){
          const a = rand01() * Math.PI * 2;
          const sp = 0.8 + rand01() * 4.2;
          addParticle({
            x, y,
            vx: Math.cos(a) * sp,
            vy: Math.sin(a) * sp - (0.6 + rand01() * 1.2),
            r: 1.3 + rand01() * 2.6,
            life: 0,
            ttl: 36 + Math.floor(rand01() * 26),
            rgb: base,
            glow: 0.9 + rand01() * 0.6,
            drag: 0.985,
            g: 0.035 + rand01() * 0.04,
          });
        }
      }

      function sparkLine(x,y){
        sparks.push({
          x, y,
          a: rand01() * Math.PI * 2,
          len: 12 + rand01() * 22,
          life: 0,
          ttl: 10 + Math.floor(rand01() * 10),
        });
        if(sparks.length > 80) sparks.splice(0, sparks.length - 80);
      }

      function loop(){
        if(!running) return;

        ctx.clearRect(0,0,W,H);

        // particles
        for(let i=particles.length-1; i>=0; i--){
          const p = particles[i];
          p.life++;
          p.vx *= p.drag;
          p.vy = (p.vy * p.drag) + (p.g * (dpr * 1.4));
          p.x += p.vx * dpr;
          p.y += p.vy * dpr;

          const t = 1 - (p.life / p.ttl);
          const a = Math.max(0, t);

          ctx.globalAlpha = a * 0.9;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r * dpr, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(${p.rgb[0]},${p.rgb[1]},${p.rgb[2]},1)`;
          ctx.shadowBlur = 18 * p.glow;
          ctx.shadowColor = `rgba(${p.rgb[0]},${p.rgb[1]},${p.rgb[2]},.55)`;
          ctx.fill();

          if(p.life >= p.ttl) particles.splice(i,1);
        }

        // spark lines
        ctx.shadowBlur = 0;
        for(let i=sparks.length-1; i>=0; i--){
          const s = sparks[i];
          s.life++;
          const t = 1 - (s.life / s.ttl);
          const a = Math.max(0, t);

          const x2 = s.x + Math.cos(s.a) * s.len * dpr;
          const y2 = s.y + Math.sin(s.a) * s.len * dpr;

          ctx.globalAlpha = a * 0.9;
          ctx.lineWidth = 1.2 * dpr;
          ctx.strokeStyle = `rgba(255,204,102,${a})`;
          ctx.beginPath();
          ctx.moveTo(s.x, s.y);
          ctx.lineTo(x2, y2);
          ctx.stroke();

          if(s.life >= s.ttl) sparks.splice(i,1);
        }

        ctx.globalAlpha = 1;
        raf = requestAnimationFrame(loop);
      }

      function pointerPos(){
        const r = elWheelWrap.getBoundingClientRect();
        const x = (r.left + r.width * 0.5) * dpr;
        const y = (r.top + 18) * dpr; // dekat pointer
        return {x,y};
      }

      function zeusPos(){
        if(!elZeusArea) return null;
        const r = elZeusArea.getBoundingClientRect();
        return { x: (r.left + r.width*0.5) * dpr, y: (r.top + r.height*0.46) * dpr };
      }

      function spinStreamTick(){
        const p = pointerPos();
        burst(p.x, p.y, 6, "gold");
        if(rand01() < 0.55) sparkLine(p.x + (rand01()-0.5)*28*dpr, p.y + rand01()*22*dpr);
      }

      function zeusIdleTick(){
        const z = zeusPos();
        if(!z) return;
        if(rand01() < 0.35) burst(z.x + (rand01()-0.5)*90*dpr, z.y + (rand01()-0.5)*110*dpr, 3, "purple");
        if(rand01() < 0.10) sparkLine(z.x + (rand01()-0.5)*120*dpr, z.y + (rand01()-0.5)*130*dpr);
      }

      function start(){
        resize();
        running = true;
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(loop);
      }

      function stop(){
        running = false;
        cancelAnimationFrame(raf);
      }

      window.addEventListener("resize", resize, { passive:true });
      document.addEventListener("visibilitychange", ()=>{
        if(document.hidden) stop();
        else start();
      });

      start();

      return { burst, sparkLine, spinStreamTick, zeusIdleTick, pointerPos, zeusPos };
    })();

    /* =========================
      BLOK 9 — SPIN MAIN
    ========================== */
    function spin(){
      const uid = getUserId();
      elUserId.value = uid; // reflect cleaned

      if(!uid){
        showToast("User ID kosong", "Isi User ID dulu baru bisa spin.");
        return;
      }
      if(isUserUsed(uid)){
        showToast("Kesempatan habis", "Spin kamu sudah dipakai untuk User ID ini.");
        setReadyUI();
        return;
      }
      if(isSpinning) return;

      clearWinLabel();
      setSpinningUI(true);

      const animate = !prefersReducedMotion;
      const myToken = ++spinToken;

      // FX spin stream
      let streamT = 0;
      if(FX && animate){
        streamT = setInterval(()=> {
          if(!isSpinning || spinToken !== myToken) return;
          FX.spinStreamTick();
        }, 90);
      }

      const pick = pickIndex(uid);
      const offset = (rand01() - 0.5) * (segSize * 0.58);
      const targetWithin360 = normDeg(360 - ((pick * segSize) + offset));

      const turns = 7 + Math.floor(rand01() * 2);
      const currMod = normDeg(currentRotation);
      const deltaToTarget = normDeg(targetWithin360 - currMod);
      currentRotation += (turns * 360) + deltaToTarget;

      // reflow safe
      requestAnimationFrame(() => applyRotation(currentRotation, animate));

      let doneCalled = false;

      const done = () => {
        if(doneCalled) return;
        doneCalled = true;

        clearInterval(streamT);

        const idx = selectedIndexFromRotation(currentRotation);
        const seg = SEGMENTS[idx];
        const prizeText = seg.label;

        markWinLabel(idx);
        setLastResult(uid, prizeText);
        elCardLast.textContent = prizeText;

        // FX win burst (pointer + center)
        if(FX){
          const p = FX.pointerPos();
          FX.burst(p.x, p.y, 34, "gold");
          FX.burst(p.x, p.y + 50, 16, "green");
          const z = FX.zeusPos();
          if(z) FX.burst(z.x, z.y, 18, "purple");
        }

        vibrate(35);

        if(seg.kind === "again"){
          setAgainUsed(uid, true);
          showToast("TRY AGAIN", "Belum menang — kamu masih punya 1 kesempatan.");
          setSpinningUI(false);
          setReadyUI();
          return;
        }

        setUserUsed(uid, true);

        if(seg.kind === "spins"){
          const prev = getSpinsTotal(uid);
          const add = Number(seg.value || 0) || 0;
          const total = prev + add;
          setSpinsTotal(uid, total);
          elCardSpins.textContent = String(total);
        }

        addHistory(uid, prizeText);
        openModal(prizeText);

        setSpinningUI(false);
        setReadyUI();
      };

      const onDone = (ev) => {
        if(ev && ev.propertyName && ev.propertyName !== "transform") return;
        elRotor.removeEventListener("transitionend", onDone);
        clearTimeout(fallbackT);
        done();
      };

      const fallbackT = setTimeout(() => {
        elRotor.removeEventListener("transitionend", onDone);
        done();
      }, animate ? 5900 : 40);

      elRotor.addEventListener("transitionend", onDone);

      if(!animate){
        setTimeout(() => {
          elRotor.removeEventListener("transitionend", onDone);
          done();
        }, 35);
      }
    }

    /* =========================
      BLOK 10 — ZEUS IMAGE INIT
    ========================== */
    function initZeus(){
      if(!elZeusImg || !elZeusError || !elZeusTried) return;

      elZeusTried.textContent = ZEUS_SRC;
      elZeusImg.src = ZEUS_SRC;

      elZeusImg.onload = () => {
        elZeusError.style.display = "none";
        elZeusImg.style.display = "block";
      };
      elZeusImg.onerror = () => {
        elZeusImg.style.display = "none";
        elZeusError.style.display = "block";
        showToast("Zeus PNG gagal dimuat", "Cek /assets/zeus.png di project kamu.");
      };
    }

    /* =========================
      BLOK 11 — EVENTS
    ========================== */
    elBtnSpin.addEventListener("click", spin);
    elHubBtn.addEventListener("click", spin);

    elBtnSetId.addEventListener("click", ()=>{
      const uid = getUserId();
      elUserId.value = uid;
      if(!uid){
        showToast("User ID kosong", "Tolong isi User ID dulu.");
        return;
      }
      storageSet(STORAGE.userId, uid);
      showToast("User ID disimpan", `User ID: ${uid}`);
      setReadyUI();
    });

    elUserId.addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){
        e.preventDefault();
        elBtnSetId.click();
      }
    });

    elUserId.addEventListener("input", ()=> {
      // update UI live tanpa nyimpen otomatis
      setReadyUI();
    });

    elToastClose.addEventListener("click", ()=> elToast.classList.remove("show"));

    elBtnCloseModal.addEventListener("click", closeModal);
    elModalOverlay.addEventListener("click", (e)=>{ if(e.target === elModalOverlay) closeModal(); });

    document.addEventListener("keydown", (e)=>{
      handleModalTab(e);
      if(e.key === "Escape"){
        if(elModalOverlay.classList.contains("show")) closeModal();
        elToast.classList.remove("show");
      }
      // Space untuk spin cepat (opsional, tidak mengganggu input)
      if(e.key === " " && !elModalOverlay.classList.contains("show")){
        const tag = (document.activeElement && document.activeElement.tagName) ? document.activeElement.tagName.toLowerCase() : "";
        if(tag !== "input" && tag !== "textarea" && !isSpinning && !elBtnSpin.disabled){
          e.preventDefault();
          spin();
        }
      }
    });

    elBtnCopy.addEventListener("click", async ()=>{
      const uid = getUserId();
      const text = `USER ID: ${uid}\nHADIAH: ${elModalPrize.textContent}\nWAKTU: ${nowText()}`;
      try{
        await navigator.clipboard.writeText(text);
        showToast("Tersalin", "Hasil spin sudah di-copy.");
      }catch(_){
        showToast("Gagal copy", "Browser menolak clipboard. Screenshot saja.");
      }
    });

    elBtnClaim.addEventListener("click", ()=>{
      showToast("Klaim", "Ini demo hiburan. Tombol klaim bisa diarahkan ke WA/Telegram/link.");
      closeModal();
    });

    elBtnClearHistory.addEventListener("click", ()=>{
      setHistory([]);
      renderHistory();
      showToast("Riwayat dihapus", "Semua riwayat lokal sudah dibersihkan.");
    });

    elBtnReset.addEventListener("click", ()=>{
      const uid = getUserId() || storageGet(STORAGE.userId, "");
      if(uid){
        setUserUsed(uid, false);
        setAgainUsed(uid, false);
        setLastResult(uid, "");
        setSpinsTotal(uid, 0);
      }
      elCardSpins.textContent = "0";
      elCardLast.textContent = "—";
      clearWinLabel();
      showToast("Reset", "Data User ID ini di-reset (try/bonus/last/spins).");
      setReadyUI();
    });

    elBtnRegister.addEventListener("click", ()=>{
      showToast("Register", "Placeholder. Bisa kamu arahkan ke link register.");
    });

    const ro = (window.ResizeObserver)
      ? new ResizeObserver(()=> layoutLabels())
      : null;
    if(ro) ro.observe(elWheelWrap);
    window.addEventListener("resize", ()=> layoutLabels(), { passive:true });

    /* =========================
      BLOK 12 — INIT
    ========================== */
    buildLabels();
    renderHistory();

    const savedId = storageGet(STORAGE.userId, "");
    if(savedId) elUserId.value = savedId;

    setReadyUI();
    initZeus();

    // FX idle ticks (Zeus aura)
    if(FX && !prefersReducedMotion){
      setInterval(()=> {
        if(document.hidden) return;
        if(isSpinning) return;
        FX.zeusIdleTick();
      }, 260);
    }
  </script>
</body>
</html>
